<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">
<head th:replace="layouts/APPHeader/apphead :: headFragment" />

<body style="background: #f5f9fa;">
    <form class="row gy-2 gx-4 align-items-center" role="form" th:object="${userFormDto}" ></form>
    <div class="content flex">
        
            <div class="header on">
                <div class="left">
                    <div class="ham">
                        <button type="button"><img th:src="@{/assets/images/ham.png}" alt=""></button>
                    </div>
                    <div class="nav_bg"></div>
                    <!-- ## Left navigator include -->
                    <th:block th:include="layouts/APPHeader/appcareleftadmin" />
                </div>
                <div class="right">
                </div> 
            </div>
            <div class="con">
                <!-- ## header top include -->
                <th:block th:include="layouts/APPHeader/appheadTop" />

                <div class="infor_bar type2">
                    <div class="left">
                        사용자관리
                    </div>
                    <ul class="right">
                        <li>
                            <button type="button" class="color2" id="retrieveBtn"> 
                                <i><img th:src="@{/assets/images/i_search.png}" alt=""></i>조회
                            </button>
                        </li> 
                    </ul>
    
                </div> 
                <div class="section ">                
                    <div class="sec_con" style="width: 100%;">
                        <div class="box_wrap">
                            <ul class="search_box"> 
                                <li>
                                    <div class="input-group mb-3"><span class="input-group-text" id="basic-addon1">사용자명</span>
                                        <input class="form-control" type="text" placeholder="사원명 또는 사용자명을 입력하세요" id="actusernamez" name="actusernamez" aria-label="actnmz" aria-describedby="basic-addon1" />                                                                            
                                      </div>
                                </li>  
                            </ul>
                            <form action="">
                                 
                                <div class="container-fluid"> 
                                    <div id="mGrid_div" ></div>
                                    <div id="thePager01"></div>
                                </div>   

                            </form>

                        </div>
                    </div>
                </div>
            </div>


 

    </div>


    <script type="text/javascript" th:inline="javascript"> 

    //$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$
    //현장 검색   
    var wapp04Grid ;
    var view_Mmanualpage;
    document.getElementById("retrieveBtn").addEventListener("click",function(){ 
        listUp();

    })   
    function tabA_grid(data){
        // console.log(data)
            var wtab01Dto  = data;    
            var wtab01_data = [];
            var cnt = 1;
            for (var i = 0; i < wtab01Dto.length; i++) {
                wtab01_data.push({
                    id: i, 
                    index: cnt, 
                    seq:     wtab01Dto[i]["seq"],
                    userid:     wtab01Dto[i]["userid"],
                    username: wtab01Dto[i]["username"], 
                    useyn:   wtab01Dto[i]["useyn"],
                    flag : wtab01Dto[i]["flag"] ,
                    phone : wtab01Dto[i]["phone"] ,
                    perid : wtab01Dto[i]["perid"]                                 
                });
                cnt++;
            }    
            wapp04Grid.columns.clear();  
            wapp04Grid.autoGenerateColumns = false; 
            view_Mmanualpage.sourceCollection  = wtab01_data;
            var cols = new wijmo.grid.Column();  
            cols = new wijmo.grid.Column(); 
            cols.binding = 'flag';
            cols.header = '사용여부';
            cols.align = "center";
            cols.width = '*'; 
            cols.cellTemplate = wijmo.grid.cellmaker.CellMaker.makeLink({ 
                text: '<b>${item.flag}</b>',
                click: (e, ctx) => {
                    wactnmChk_2(ctx.item.userid, ctx.item.useyn, ctx.item.username);
                }
            });
            wapp04Grid.columns.push(cols);  
            cols = new wijmo.grid.Column(); 
            cols.binding = 'userid';
            cols.header = '아이디';
            cols.align = "center";
            cols.width = '*'; 
            wapp04Grid.columns.push(cols);  
            cols = new wijmo.grid.Column(); 
            cols.binding = 'username';
            cols.header = '사용자';
            cols.align = "center";
            cols.width = '*'; 
            wapp04Grid.columns.push(cols);  
            cols = new wijmo.grid.Column(); 
            cols.binding = 'perid';
            cols.header = '사원번호';
            cols.align = "center";
            cols.width = '*'; 
            wapp04Grid.columns.push(cols);   
            cols = new wijmo.grid.Column(); 
            cols.binding = 'phone';
            cols.header = '전화번호';
            cols.align = "center";
            cols.width = '*'; 
            wapp04Grid.columns.push(cols);
 
        }

        function wactnmChk_2(arg1, arg2, arg3){  
            if (arg2 == "Y"){
                if (!confirm(arg3 + " : 미사용으로 변경하시겠습니까?")) {
                    return ;
                } 
                arg2 = "N"
            }else{
                if (!confirm(arg3 + " : 사용으로 변경하시겠습니까?")) {
                    return ;
                } 
                arg2 = "Y"
            }
            $.ajax({
                url: '/appadmod/id01mod',   
                type:"POST",
                data: {
                    "actseqz"    : arg1 ,
                    "actuseynz"    : arg2
                },
                async:false,
                success:function(data){
                    if(data == "success"){
                        alert("변경되었습니다.")
                        // console.log("MOD", data); 
                        listUp();
                    }else{
                        alert("변경중 오류가 발생했습니다. 관리자에게 문의하세요.")
                    }
                },error:function(e){
                    console.log('error',e);
                }
            }).done(function(fragment){

            })

          listUp();
 
        }      

        
    function listUp(){
        var ls_actusernamez = document.getElementById('actusernamez').value;  
            if(ls_actusernamez == null || ls_actusernamez.length == 0 || ls_actusernamez == ""){
                ls_actusernamez = "%"; 
            }   
            $.ajax({
                url: '/appadmod/id01list',  
                type:"POST",
                data: { 
                    "actusernamez"      : ls_actusernamez,  
                }, 
                async:false,
                success:function(data){   
                    tabA_grid(data);
                },error:function(e){
                    console.log("error");
                    // alert(data.code);
                    // alert(data.message);
                }
            }).done(function(fragment){           

            })  
    }

//$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$
    window.onload = function() { 
        view_Mmanualpage = new wijmo.collections.CollectionView(getData_wlist(), {
            pageSize: 20
        });  
        // 페이지 이동
        new wijmo.input.CollectionViewNavigator('#thePager01', {
            byPage: true,
            headerFormat: 'Page {currentPage:n0} of {pageCount:n0}',
            cv: view_Mmanualpage
        });    
        wapp04Grid = new wijmo.grid.FlexGrid('#mGrid_div', {  
            autoGenerateColumns: false, 
            selectionMode: 'RowRange',
            alternatingRowStep: 0,
            columns: [   
  
                { binding: 'flag',width: '*', header: '사용여부', width: '*', align:"center", format: '*' ,
                        cellTemplate: wijmo.grid.cellmaker.CellMaker.makeLink({ 
                            text: '<b>${item.flag}</b>',
                            click: (e, ctx) => {
                                wactnmChk_2(ctx.item.userid, ctx.item.useyn, ctx.item.username );
                            }
                        })
                    },   
                { binding: 'userid', header: '아이디', width: '*',   align:"center",  isReadOnly: true } ,
                { binding: 'username', header: '사용자', width: '*', format: '*' , align:"center", isReadOnly: true}, 
                { binding: 'perid', header: '사원번호', width: '*', format: '*', align:"center", isReadOnly: true },  
            ], 
            itemsSource: view_Mmanualpage
        });  
        wapp04Grid.hostElement.addEventListener("click",function(e){
            var ht = wapp04Grid.hitTest(e);
            if(ht.cellType === wijmo.grid.CellType.Cell){
                console.log(ht._p._rows );
                //  data = ht.RowCollection(ht.row); // e.getCellData(ht.row, 0, false); 
                // console.log(data);

            }
        })
        // 설비메뉴얼 데이터 수집
        function getData_wlist(){
            var mapp04Dto = [[${appUserListDto}]]; 
            var data01 = [];
            var cnt = 1;


            for (var i = 0; i < mapp04Dto.length; i++) {
                data01.push({
                    id: i, 
                    index: cnt,
                    seq:     mapp04Dto[i]["seq"],
                    userid:     mapp04Dto[i]["userid"],
                    username: mapp04Dto[i]["username"], 
                    useyn:   mapp04Dto[i]["useyn"],
                    flag : mapp04Dto[i]["flag"] ,
                    phone : mapp04Dto[i]["phone"] ,
                    perid : mapp04Dto[i]["perid"]        
                });
                cnt++;
            }  
            // console.log(data01);            
            return data01                                          
        }         
    }
   

    </script>

    <!------footer ------>
    <footer th:replace="layouts/APPHeader/appfooter :: footerFragment"></footer> 

 
    
</body>
</html>