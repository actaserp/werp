<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- mapper >> interface 매핑 : id 값 중요 (interface 메소드) -->
<mapper namespace="com.actas.ems.Mapper.Elvlrt.App10ElvlrtMapper">
<!--      조회  -->
    <select id="GetApp10List001"  parameterType="com.actas.ems.DTO.Elvlrt.App10ElvlrtDto" resultType="com.actas.ems.DTO.Elvlrt.App10ElvlrtDto">
        <![CDATA[SELECT Left(a.recedate,4) + '-' + substring(a.recedate, 5,2) + '-' + substring(a.recedate, 7,2) as recedate,
                        a.custcd,
                        a.spjangcd,
                        a.recenum,
                        a.cltcd,
                        a.actcd,
                        b.actnm,
                        b.perid as actperid,
                        e.pernm as actpernm,
                        a.equpcd,
                        c.equpnm,
                        a.contcd,
                        d.contnm,
                        a.contents,
                        a.recetime,
                        a.perid,
                        e.pernm,
                        a.divicd,
                        f.divinm,
                        CASE a.resultck WHEN '1' THEN '처리'
                                        WHEN '0' THEN '미처리'
                        end as resultck
    FROM tb_e401 a WITH(NOLOCK)
                     LEFT OUTER JOIN TB_E601 b WITh(NOLOCK) ON (a.custcd = b.custcd AND a.spjangcd = b.spjangcd AND a.actcd = b.actcd)
                     LEFT OUTER JOIN TB_E611 c WITh(NOLOCK) ON (a.custcd = c.custcd AND a.spjangcd = c.spjangcd AND a.actcd = c.actcd AND  a.equpcd = c.equpcd)
                     LEFT OUTER JOIN TB_E010 d WITh(NOLOCK) ON (a.custcd = d.custcd AND a.spjangcd = d.spjangcd AND a.contcd = d.contcd)
                     LEFT OUTER JOIN TB_JA001 e WITh(NOLOCK) ON (a.custcd = e.custcd AND a.spjangcd = e.spjangcd AND a.perid = e.perid)
                     LEFT OUTER JOIN TB_JC002 f WITh(NOLOCK) ON (a.custcd = f.custcd AND a.spjangcd = f.spjangcd AND a.divicd = f.divicd)
                 WHERE
                     a.spjangcd = #{spjangcd}
                   AND a.resultck like CONCAT('%',#{changeop},'%')
                   AND a.recedate BETWEEN #{frdate} AND #{todate}
        ]]>
    </select>


<!--    //////////////////////////////수정중-->

    <!--게시글 작성 전부 tb_e411에 있는 상황이고 이걸 icd hidden 으로 받아온 값을 받아야한다.-->
    <insert id="Insert10Manul" parameterType="com.actas.ems.DTO.Elvlrt.App10ElvlrtDto">
        insert into tb_e411 (custcd, spjangcd, compnum, actperid, perid, arrivdate, compdate, arrivtime, comptime, remoremark, resuremark, remark, inputdate, inperid) values (#{custcd}, #{spjangcd}, #{compnum}, #{actperid}, #{perid}, #{arrivdate}, #{compdate}, #{arrivtime}, #{comptime}, #{remoremark}, #{resuremark}, #{remark}, #{inputdate}, #{inperid} )
    </insert>

    <update id="Update10Manul" parameterType="com.actas.ems.DTO.Elvlrt.App10ElvlrtDto">
        update tb_e411
        set custcd = #{custcd}
        <if test="compnum != null ">,</if>
        <if test="compnum != null">compnum=#{compnum}</if>
        <if test="actperid != null ">,</if>
        <if test="actperid != null">actperid=#{actperid}</if>
        <if test="perid != null ">,</if>
        <if test="perid != null">perid=#{perid}</if>
        <if test="arrivdate != null ">,</if>
        <if test="arrivdate != null">arrivdate=#{arrivdate}</if>
        <if test="compdate != null ">,</if>
        <if test="compdate != null">compdate=#{compdate}</if>
        <if test="arrivtime != null ">,</if>
        <if test="arrivtime != null">arrivtime=#{arrivtime}</if>
        <if test="comptime != null ">,</if>
        <if test="comptime != null">comptime=#{comptime}</if>
        <if test="remoremark != null ">,</if>
        <if test="remoremark != null">remoremark=#{remoremark}</if>
        <if test="resuremark != null ">,</if>
        <if test="resuremark != null">resuremark=#{resuremark}</if>
        <if test="remark != null ">,</if>
        <if test="remark != null">remark=#{remark}</if>
        <if test="inputdate != null ">,</if>
        <if test="inputdate != null">inputdate=#{inputdate}</if>
        <if test="inperid != null ">,</if>
        <if test="inperid != null">inperid=#{inperid}</if>
        <if test="indate != null ">,</if>
        <if test="indate != null">indate=#{indate}</if>


        where compnum = #{compnum}
    </update>

    <!-- seq set, 6개 포맷으로 가져온다는 뜻임-->
    <select id="get10ManualMaxSeq" parameterType="string" resultType="java.lang.String">
        select max(compnum) from tb_e411 where compdate = #{compdate}
    </select>

</mapper>
